*   **Source:** PostgreSQL Extension Network
*   **RFC**: TBD
*   **Version**: 2.0.0-draft1
*   **Status**: Draft
*   **Category**: Standards Track
*   **Published**: TBD
*   **Authors**:
    *   David E. Wheeler, PGXN, Tembo

# RFC TBD
# PostgreSQL Extension Network Distribution Metadata Specification

## Abstract ##

This document describes version 2.0.0 of the PGXN distribution metadata
specification, also known as the "PGXN Meta Spec." PGXN Metadata ships with
PostgreSQL extension source distribution packages, and serves to describe the
extension for the benefit of automated indexing, distribution, full-text
search, binary packaging, and more.

## Status of This Memo ##

This is an Internet Standards Track document.

This RFC represents the consensus of the distributed community of PostgreSQL
extension developes, distributors, and packagers, generally referred to as the
"PostgreSQL Extension Ecosystem". It is formatted using the [Github Flavored
Markdown] variant of [Markdown], and the canonical copy may always be found at
[master.pgxn.org/meta/spec.txt]. A generated HTML-formatted copy found at
[pgxn.org/spec/] may also be considered canonical.

Information about the current status of this document, any errata, and how to
provide feedback on it may be obtained from its [source code repository].

## Copyright Notice ##

Copyright (c) 2010-2024 PGXN and the persons identified as the document
authors. All rights reserved.

This RFC is distributed under the [CC BY-SA 4.0] license.

Code Components extracted from this document **MUST** include the [PostgreSQL
License].

## Introduction ##

Distribution metadata describe important properties of PGXN source code
distributions. Tools that build PGXN source distribution archives should
create a metadata file in accordance with this specification and include it
with the distribution for use by automated tools that index, examine, package,
or install PGXN source distributions.

### Terminology ###

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
interpreted as described in [IETF RFC 2119].

This document makes use of the following additional terms:

#### Package ####

A collection of extensions that are released, versioned, and distributed
together. Packages may be downloaded directly from version control
repositories or in [archive files] generated by a release tag.

#### Source Distribution ####

An archive of the source code for the release of a Package, together with
metadata defined by this spec, distributed for other developers to build,
install, and use. The file name of a Source Distribution consists of the
package name, a dash, and the version, e.g., `pgtap-1.14.3.zip`.

#### Extension ####

A software component that extends the capabilities of a PostgreSQL database or
cluster. Extensions may be `CREATE EXTENSION` [extensions], [background
workers], command-line apps, [loadable modules], shared libraries, and more.

#### Consumer ####

Code that reads a metadata file, deserializes it into a data structure in
memory, or interprets a data structure of metadata elements.

#### Producer ####

Code that constructs a metadata data structure, serializes it into a byte
stream, and/or writes it to disk.

### Data Types ###

Properties in the [Structure](#structure) section describe data elements, each
of which has an associated data type as described herein. Each is based on the
primitive types defined by [JSON]: *object*, *array*, *string*, *number*, and
*boolean*. Other types are subtypes of these primitives and define compound
data structures or define constraints on the values of a data element.

#### Boolean ####

A *Boolean* is used to provide a true or false value. It **MUST** be
represented as a defined (not `null`) value.

#### String ####

A *String* is data element containing a non-zero length sequence of Unicode
characters.

#### Array ####

An *Array* is an ordered collection of one or more data elements. Items in an
Array may be of mixed types.

#### Object ####

An *Object* is an unordered collection of zero or more data elements
("values"), indexed by associated [String](#string) elements ("keys"). An
Object's values may be of mixed types.

#### Term ####

A *Term* is a [String](#string) that **MUST** be at least two characters long,
and contain no slash (`/`), backslash (`\`), control, or space characters.

#### Tag ####

A *Tag* is a [String](#string) that **MUST** be at least two and no more than
255 characters long, and contain no slash (`/`), backslash (`\`), or control
characters.

#### URI ####

*URI* is a [String](#string) containing a valid Uniform Resource Identifier or
Locator as defined by [IETF RFC 3986].

#### Path ####

*Path* is a [String](#string) with a relative file path that identifies a file
in the distribution. The path **MUST** be specified with unix conventions.

#### Version ####

A *Version* is a [String](#string) containing a value that describes the
version number of extensions or distributions, and adhere to the format of the
[Semantic Versioning 2.0.0 Specification][semver].

#### Version Range ####

A *Version Range* is a [String](#string) that describes a range of Versions
that may be present or installed to fulfill prerequisites. It is specified in
detail in the [Version Ranges](#version-ranges) section.

#### License String ####

A *License String* is a [String](#string) with a restricted set of values.
Valid values are defined by the [SPDX License].

#### License Expression ####

A *License Expression* is a [String](#string) that represents one or more
licenses under which the contents of the package are distributed by combining
License Strings into a single value. The format is defined by the [SPDX
Standard License Expression].

#### purl ####

A [String](#string) containing a valid package URL defined by the [purl spec].
All known [purl Types] may be used, as well as `pgxn` for PGXN packages and
`postgres` for PostgreSQL core [contrib] or development packages.

#### Platform ####

A [Platform] specification is a [String](#string) that identifies a supported
platform with one to three dash-delimited substrings: An OS name, the OS
version, and the architecture: `$os-$version-$architecture`.

If the string contains no dash, it represents only the OS. If it contains a
single dash, the values represent the OS and the architecture. The complete
list of values will be determined by the [bulid farm animals]. Some likely
Examples:

*   `linux`: Any Linux
*   `linux-x86_64`: Any Linux on x86_64
*   `gnulinux-x86_64`: [GNU] Linux on x86_64
*   `musllinux-1.2-aarch64`: [musl] Linux v1.2 on aarch64
*   `darwin`: Any Darwin (macOS)
*   `darwin-23.5.0-aarch64`: Darwin (macOS) 23.5.0 on aarch64

## Structure

The metadata structure is an [Object](#object). This section describes valid
properties of the [Object](#object).

Any properties not described in this specification document (whether top-level
or within compound data structures described herein) are considered *custom
properties* and **MUST** begin with an "x" or "X" and be followed by an
underscore; i.e., they must match the regular expression pattern `^[xX]_.`. If
a custom property refers to a compound data structure, properties within it do
not need an "x_" or "X_" prefix.

[Consumers](#consumer) of metadata may ignore any or all custom properties.
All other properties not described herein are invalid and should be ignored by
[Consumers](#consumer). [Producers](#producer) must not generate or output
invalid properties.

For each property, one or more examples are provided followed by a
description. The description begins with the version of spec in which the
property was added or in which the definition was modified, whether the
property is *required* or *optional*, and the data type of the corresponding
value. These items are in parentheses, brackets, and braces, respectively.

If a data type is an [Object](#object), valid sub-properties will be described
as well.

All examples are represented as [JSON].

<!-- Nothing deprecated yet.
Some properties are marked *Deprecated*. These are shown for historical
context and must not be produced in or consumed from any metadata structure of
version 2 or higher.
-->

### Required Properties

#### abstract ####

``` json
"abstract": "Unit testing for PostgreSQL"
```

(Spec 1) [required] {[String](#string)}

This is a short description of the purpose of the distribution.

#### maintainers ####

```json
"maintainers": [
  {
    "name": "David E. Wheeler",
    "url": "https://pgxn.org/user/theory"
  }
]
```

```json
"maintainers": [
  {
    "name": "David E. Wheeler",
    "url": "https://pgxn.org/user/theory"
  },
  {
    "name": "Josh Berkus",
    "email": "jberkus@pgxn.org"
  }
]
```

(Spec 2) [required] {[Array](#array) of [Objects]{#object}}

This property indicates the person(s) to contact concerning the distribution.
Each [Object](#object) in the [Array](#array) consists of the following
properties:

*   **name**: The name of the maintainer. **Required**.
*   **email**: The email address of the maintainer.
*   **url**: The URL for the maintainer.

Either `email` or `url` or both must be present.

This property provides a general contact list independent of other structured
fields provided within the [resources](#resources) field, such as `issues`.
The addressee(s) can be contacted for any purpose including but not limited
to: (security) problems with the distribution, questions about the
distribution, or bugs in the distribution.

A distribution’s original author is usually the contact listed within this
field. Co-maintainers, successor maintainers, or mailing lists devoted to the
distribution may also be listed in addition to or instead of the original
author.

#### license ####

``` json
"license": "MIT"
```

``` json
"license": "MIT AND BSD-2-Clause"
```

(Spec 1) [required] {[License String](#license-string) or [License Expression](#license-expression)}

One or more licenses that apply to some or all of the files in the
distribution. For [License Expressions](#license-expression), the distribution
documentation should be consulted to clarify the interpretation of multiple
licenses.

#### contents ####

``` json
"contents": {
  "extensions": {
    "pair": {
      "sql": "sql/pair.sql",
      "doc": "doc/pair.md",
      "abstract": "A key/value pair data type",
      "preload": "session",
      "tle": true,
      "control": "pair.control"
    }
  }
```

``` json
"contents": {
  "workers": {
    "pair_pruner": {
      "bin": "bin/pair_pruner",
      "doc": "doc/pair_pruner.md",
      "abstract": "A worker to periodically prune pairs"
    }
  },
  "modules": {
    "lib_pair": {
      "lib": "lib/lib_pair",
      "doc": "doc/lib_pair.md",
      "abstract": "A library hooking function calls to convert pairs to named parameters",
      "load": "shared_preload_libraries"
    }
  }
}
```

``` json
"contents": {
  "apps": {
    "pair_rand": {
      "bin": "bin/pair_rand",
      "doc": "doc/pair_rand.md",
      "abstract": "Command to generate random pairs of strings"
    }
  },
  "libraries": {
    "ruby_pair": {
      "dir": "lib/gems",
      "abstract": "Ruby libraries required to run the extension"
    }
  }
}
```

(Spec 1) [required] {[Object](#object) of [Objects](#object) of [Terms](#term)}

A description of what's included in the package. This information is used by
PGXN to build indexes identifying in which package various extensions
can be found.

The properties of `contents` identify the types of extensions in the package.
At least one property must be present in the `contents` object. The properties
are as follows:

*   **extensions**: [Objects](#object) describing `CREATE EXTENSION`
    [extensions]. Properties are extension name [Terms](#term), and values are
    objects with the following fields:
    *   **sql**: A [Path](#path) pointing to the SQL file used by `CREATE
        EXTENSION`. Required.
    *   **control**: A [Path](#path) pointing to the [control file] used by
        `CREATE EXTENSION`. Required.
    *   **doc**: A [Path](#path) pointing to the main documentation file for
        the extension (ideally not just a README).
    *   **abstract**: A [String](#string) containing a short description of
        the extension.
    *   **tle**: A [Boolean](#boolean) that, when `true`, indicates that the
        extension can be used as a [trusted language extension].
    *   **preload**: A[Boolean](#boolean) that, when `true`, indicates that
        the extension's libraries need to be loaded in advance via
        `shared_preload_libraries`, `session_preload_libraries`, or
        `local_preload_libraries`.
*   **workers**: [Objects](#object) describing [background workers].
    Properties are worker name [Terms](#term), and values [Objects](#object)
    with the following properties:
    *   **src**: A [Path](#path) pointing to the main source file for the
        background worker.
    *   **doc**: A [Path](#path) pointing to the main documentation file for
        the background worker (ideally not just a README).
    *   **abstract**: A [String](#string) containing a short description of
        the background worker.
*   **apps**: [Objects](#object) describing applications, command-line or
    otherwise. Properties are are app name [Terms](#term), and values
    [Objects](#object) with the following properties:
    *   **src**: A [Path](#path) pointing to the main source file for the app.
    *   **doc**: A [Path](#path) pointing to the main documentation file for
        the app (ideally not just a README).
    *   **abstract**: A [String](#string) containing a short description of
        the app.
*   **modules**: [Objects](#object) describing [loadable modules] that can be
    loaded into Postgres. Extensions that include libraries do not need to
    include those libraries here. Properties are module name [Terms](#term),
    and values [Objects](#object) with the following properties:
    *   **src**: A [Path](#path) pointing to the main source file for the
        module.
    *   **doc**: A [Path](#path) pointing to the main documentation file for
        the module (ideally not just a README).
    *   **abstract**: A [String](#string) containing a short description of
        the module.
    *   **preload**: A[Boolean](#boolean) that, when `true`, indicates that
        the module's libraries need to be loaded in advance via
        `shared_preload_libraries`, `session_preload_libraries`, or
        `local_preload_libraries`.
*   **libraries**: [Objects](#object) listing other libraries that may ship in
    the package and need to be installed but are not [loadable modules], such
    as a dynamic library used by an app. Properties are library name
    [Terms](#term), and values [Objects](#object) with the following
    properties:
    *   **src**: A [Path](#path) pointing to the main source file or directory
       of files for the library.
    *   **doc**: A [Path](#path) pointing to the main documentation file for
        the library (ideally not just a README).
    *   **abstract**: A [String](#string) containing a short description of
        the app.

#### meta-spec ####

``` json
"meta-spec": {
  "version": "2.0.0",
  "url": "https://pgxn.org/meta/v2/spec.txt"
}
```

(Spec 1) [required] {[Map](#Map)}

This field indicates the [Version](#Version) of the PGXN Meta Spec that should
be used to interpret the metadata. Consumers must check this key as soon as
possible and abort further metadata processing if the meta-spec
[Version](#version) is not supported by the consumer.

The following properties are valid, but only `version` is required.

*   **version**: The [Version](#version) of the PGXN Meta Spec against which
    the metadata object was generated.

*   **url**: The [URI](#uri) of the metadata specification corresponding to
    the given version. This is strictly for human-consumption and should not
    impact the interpretation of the metadata structure.

#### name ####

Example:

``` json
"name": "pgTAP"
```

(Spec 1) [required] {[Term](#Term)}

This property is the name of the package. This is usually the same as the name
of the "main extension" in the distribution, but may be completely unrelated
to the extensions within the distribution. This value will be used in the
distribution file name on PGXN.

#### version ####

``` json
"version": "1.3.6"
```

(Spec 1) [required] {[Version](#version)}

This property gives the version of the distribution to which the metadata
structure refers. Its value **MUST** be a [Version](#version).

All of the items listed in [contents](#contents) will be considered to have
this version; any references they make to a version, such as the [control
file], should be compatible with this version.

### Optional Fields ###

#### description ####

``` json
"description": "pgTAP is a suite of database functions that make it easy to write TAP-emitting unit tests in psql scripts or xUnit-style test functions."
```

(Spec 1) [optional] {[String](#string)}

A longer, more complete description of the purpose or intended use of the
distribution, answering the question "what is this thing and what value is
it?"

#### generated_by ####

Example:

``` json
"generated_by": "Module::Build::PGXN version 0.42"
```

(Spec 1) [optional] {[String](#string)}

This property indicates the tool that was used to create this metadata. There
are no defined semantics for this property, but it is traditional to use a
string in the form "Software package version 1.23", or the maintainer's name
if the metadata was generated by hand.

#### classification ####

``` json
{
  "tags": [
    "testing",
    "pair",
    "parameter"
  ],
  "categories": [
    "Machine Learning"
  ]
}
```

(Spec 2) [optional] {[Object](#object) of [Arrays](#array) of [Tags](#tag)}

Classification metadata  associates additional information to improve
discovery. This object **MUST** contain at least one of the following
properties:

*   **tags**: An [Array](#array) of one or more keyword [Tags](#tag)s that
    describe the distribution.
*   **categories**: An [Array](#array) of at least one and no more than three
    of the following [Strings](#string) that categorize the distribution:
    *   Analytics
    *   Auditing and Logging
    *   Change Data Capture
    *   Connectors
    *   Data and Transformations
    *   Debugging
    *   Index and Table Optimizations
    *   Machine Learning
    *   Metrics
    *   Orchestration
    *   Procedural Languages
    *   Query Optimizations
    *   Search
    *   Security
    *   Tooling/Admin

#### ignore ####

``` json
"ignore": [
  "/src/private",
  "/src/file.sql",
  "*.html"
]
```

(Spec 2) [optional] {[Array](#Array) of [Strings](#string)}

This [Array](#array) describes any files or directories that are private to
the packaging or implementation of the distribution and should be ignored by
indexing or search tools. Values are [Strings](#string) based on a subset of
the [gitignore format].

#### dependencies ####

``` json
"dependencies": {
  "postgres": {
    "version": "14"
  },
```

``` json
"dependencies": {
  "postgres": {
    "version": ">= 12, < 17",
    "with": [ "xml", "uuid", "perl" ]
  },
  "pipeline": "pgxs",
  "prereqs": {
    "build": {
      "requires": [
        "pkg:generic/awk",
        "pkg:generic/perl@5.20"
      ],
      "recommends": [
        "pkg:generic/jq",
        "pkg:generic/perl@5.40"
      ]
    }
  }
}
```

``` json
"dependencies": {
  "pipeline": "pgrx",
  "platforms": [
    "linux-amd64",
    "linux-amd64v3",
    "gnulinux-arm64",
    "musllinux-amd64",
    "darwin-23.5.0-arm64"
  ],
  "prereqs": {
    "configure": {
      "requires": [ "pkg:cargo/cargo-pgrx@0.11.4" ]
    },
    "test": {
      "requires": [
        "pkg:postgres/pg_regress",
        "pkg:postgres/plpgsql"
        "pkg:pgxn/theory/pgtap@1.1.0"
      ]
    },
    "run": {
      "requires": [
        "pkg:postgres/plperl"
        "pkg:pgxn/theory/hostname"
      ]
    }
  }
}
```

``` json
"dependencies": {
  "postgres": {
    "version": ">= 15, < 16"
  },
  "pipeline": "pgxs",
  "platforms": [
    "linux-amd64", "linux-arm64",
    "darwin-amd64", "darwin-arm64"
  ],
  "dependencies": {
    "configure": {
      "requires": {
        "external": [
          "pkg:cargo/cargo-pgrx@0.11.4",
          "pkg:generic/bison",
          "pkg:generic/cmake",
          "pkg:generic/flex",
          "pkg:generic/readline",
          "pkg:generic/openssl",
          "pkg:generic/pkg-config"
        ]
      }
    },
    "run": {
      "requires": [
          "pkg:generic/penblas",
          "pkg:generic/python3",
          "pkg:generic/readline",
          "pkg:generic/openssl",
          "pkg:generic/bison"
      ],
      "recommends": [
          "pkg:pypi/pyarrow)@11.0.0",
          "pkg:pypi/catboost",
          "pkg:pypi/lightgbm",
          "pkg:pypi/torch",
          "pkg:pypi/torchaudio",
          "pkg:pypi/torchvision",
          "pkg:pypi/xgboost",
          "pkg:pypi/accelerate",
          "pkg:pypi/bitsandbytes",
          "pkg:pypi/ctransformers",
          "pkg:pypi/huggingface-hub",
          "pkg:pypi/deepspeed",
          "pkg:pypi/einops",
          "pkg:pypi/optimum",
          "pkg:pypi/peft",
          "pkg:pypi/tokenizers",
          "pkg:pypi/transformers",
          "pkg:pypi/transformers-stream-generator",
          "pkg:pypi/InstructorEmbedding",
          "pkg:pypi/sentence-transformers",
          "pkg:pypi/rouge",
          "pkg:pypi/sacrebleu",
          "pkg:pypi/sacremoses",
          "pkg:pypi/datasets",
          "pkg:pypi/orjson",
          "pkg:pypi/langchain"
      ]
    }
  },
  "variations": [
    {
      "where": {
        "platforms": ["linux"]
      },
      "dependencies": {
        "prereqs": {
          "run": {
            "recommends": [
              "pkg:pypi/auto-gptq",
              "pkg:pypi/xformers"
            ]
          }
        }
      }
    }
  ]
},
```

(Spec 2) [optional] {[Object](#object)}

This property identifies dependencies required to configure, build, test,
install, and run the extensions in the distribution, expressed as
[purls](#purl). These include not only other extensions, but also external
libraries, system dependencies and the versions of PostgreSQL required, as
well as any OS and version dependencies and architectures ([arm64], [amd64],
etc.).

[Consumers](#consumer) **SHOULD** use this data to determine what dependencies
to install.

Properties:

*   **platforms**: An [Array](#array) of one or more [Platform](#platform)
    strings that identify OSes and architectures supported by the
    distribution. If this property is not present, [Consumers](#consumer)
    **SHOULD** assume that the distribution supports any platform that
    PostgreSQL supports. Typically only needed when the distribution depends
    on platform-specific features.

*   **postgres**: An [Object](#object) describing the versions of PostgreSQL
    required by the package. The object supports the following keys:

    *   **version**: A [Version Range](#version-range) identifying the
        supported versions of PostgreSQL. Required.
    *   **with**: An [Array](#array) of [Terms](#term) that correspond
        features that are required to be compiled into PostgreSQL. Each
        corresponds to the appropriate `--with` [configure flags]. Optional.

*   **pipeline**: A [Term](#term) identifying the build pipeline required to
    configure, build, test, and install the distribution's contents. Supported
    values **MAY** include:

    *   pgxs
    *   meson
    *   pgrx
    *   autoconf
    *   gem
    *   cpan
    *   pip
    *   go
    *   rust

    If this field is not present, [Consumers](#consumer) **MAY** use
    heuristics to ascertain the pipeline to use, such as the presence or
    absence of a `Makefile`, `Cargo.toml` file, etc.

*   **prereqs**: An [Object](#object) defining dependencies required for
    different phases of the build process. The supported properties are:

    *   **configure**: Dependencies to configure the package (e.g., items
        required for `./configure` to work)
    *   **build**: Dependencies to build the package but not to run the
        package (e.g., items required for `make` to work)
    *   **test**: Dependencies to test the package, but not to build and
        run dependencies
    *   **run**: Dependencies to run the package
    *   **develop**: Dependencies to develop the package, but not for any
        other phase dependencies

    Each of these properties points to an [Object](#object) with at least one
    of these properties:

    *   **requires**: Required to use the package
    *   **recommends**: Not required, but recommended as a best practice
    *   **suggests**: Not required, but nice to have
    *   **conflicts**: Package will not work with these items

    Each of these properties, in turn, points to an [Array](#array) of
    [purls](#purl). All known [purl Types] may be used to identify
    dependencies and specific versions. [Producers](#producer) **SHOULD**
    specify dependencies of two additional types:

    *   **`pkg:pgxn`**: Packages distributed via [PGXN]. These must include
        both the username and package name, e.g., `pkg:pgxn/theory/pair`.
    *   **`pkg:postgres`**: Dependencies distributed as part of the PostgreSQL
        core, including [contrib] or development packages such as
        [auto_explain], [dblink], [pg_regress] and [pg_isolation_regress].
        Example: `pkg:postgres/dblink`.

    [Consumers](#consumer) They also **SHOULD** use [Repology] to resolve
    `pkg:generic` [purls](#purl) to packages specific to the platform on which
    an extension is being built. This is useful for specifying system
    dependencies that vary by name and packaging system. Otherwise, they
    **MAY** use whatever techniques or heuristics are appropriate to install
    dependencies.

    [Producers](#producer) **SHOULD** avoid OS-specific [purls](#purl) such as
    `pkg:rpm:/libreadline-dev` unless the package supports only OSes that
    provide such packages. (See the next item, "variations", for
    platform-specific dependency specification.)

*   **variations**: An [Array](#array) of [Object](#object)s that define
    dependency variations. Each object contains two properties:

    *   **where**: An [Object](#object) containing the subset of the
        [dependencies](#dependencies) to identify a variation, such as
        `{ "platforms": ["gnulinux-arm64", "gnulinux-amd64"] }`
        for Linux configurations, or
        `{"postgres": { "version": ">= 16, < 17" }}`. Must not include a
        `variations` property.
    *   **dependencies**: An [Object](#object) containing the subset of
        [dependencies](#dependencies) required for the `where` property's
        configuration. Must not include a `variations` property.

#### resources ####

``` json
"resources": {
  "homepage": "https://pair.example.com",
  "issues": "https://github.com/example/pair/issues",
  "documentation": "https://pair.example.com/docs",
  "support": "https://github.com/example/pair/discussions",
  "repository": "https://github.com/example/pair",
  "badges": [
    {
      "alt": "Test Status",
      "src": "https://test.packages.postgresql.org/github.com/example/pair.svg"
    }
  ]
}
```

(Spec 2) [optional] {[Object](#object)}

This property provides external information about the package, mostly links,
including source code repository, issues, documentation, badges, etc.
[Consumers](#consumer) may use this data for links and displaying useful
information about the package.

The `resources` object must contain at least one of the following properties:

*   **homepage**: [URI](#uri) for the official home of the project on the web.
*   **issues**: [URI](#uri) for the package's issue tracking system.
*   **repository**: [URI](#uri) for the package's source code repository.
*   **documentation**: [URI](#uri) for the package's documentation.
*   **support**: [URI](#uri) for support resources and contacts for the
    package.
*   **badges**: An [Array](#array) of [Objects](#object) linking to badge
    images that should follow the [Shields badge specification]. It must have
    at least one entry, and all entries requires two properties:
    *   **src**: The [URI](#uri) for the badge.
    *   **alt**: Alt text for the badge.

#### artifacts ####


``` json
[
  {
    "type": "source",
    "url": "https://github.com/theory/pg-pair/releases/download/v1.1.0/pair-1.1.0.zip",
    "sha256": "2b9d2416096d2930be51e5332b70bcd97846947777a93e4a3d65fe1b5fd7b004"
  },
  {
    "type": "binary",
    "url": "https://github.com/theory/pg-pair/releases/download/v1.1.0/pair-1.1.0-linux-amd64.tar.gz",
    "sha1": "12d9bc5cfb6bc3c453627eac69511f48be63cfc0"
  },
  {
    "type": "binary",
    "url": "https://github.com/theory/pg-pair/releases/download/v1.1.0/pair-1.1.0-linux-arm64.tar.gz",
    "sha1": "787dc39137f7d1510a33ab0a1b8905cd5f3f72d1"
  }
]
```

(Spec 2) [optional] {[Array](#array)}

An [Array](#array) of [Objects](#objects) describing links and checksums for
downloading the distribution in one or more formats, including source code,
binaries, system packages, and more. [Consumers](#consumer) my use this
information to determine the best option for installing an extension on a
particular system. Useful for projects that publish their own binaries in
GitHu releases and the like.

The [Array](#array) must have at least one [Object](#object). The properties
of each [Object](#object) are:

*   **url**: A [URI](#uri) to download the artifact. Required.
*   **sha256** or **sha512**: A [String](#string) containing a SHA-256 or
    SHA-512 checksum in hex format. Required.
*   **type**: The type of artifact. Must a single lowercase word describing
    the artifact, such as none of `binary`, `source`, `rpm`, `homebrew`, etc.
    Required.
*   **platform**: A [Platform](#platform) string identifying the platform the
    artifact was built for. Recommended for packages compiled for a specific
    platform, such as a C extension compiled for `linux-x86_64`.

Each URL **MUST** properly resolve and the checksum must match.

Version Numbers
===============

Version Format
--------------

This section defines the [Version](#Version) type, used by several
fields in the PGXN Meta Spec.

Version numbers must be treated as strings, and adhere to the [Semantic
Versioning 2.0.0 Specification][semver]. Semantic versions take a
dotted-integer format consisting of three positive integers separated by full
stop characters (i.e. "dots", "periods" or "decimal points"). A "pre-release
version" *may* be denoted by appending a dash followed by an arbitrary ASCII
string immediately following the patch version. Please see [the
specification][semver] for all details on the format.

Version Ranges
--------------

Some fields (`prereqs`) indicate the particular version(s) of some other
extension that may be required as a prerequisite. This section details the
[Version Range](#Version.Range) type used to provide this information.

The simplest format for a Version Range is just the version number itself,
e.g. `2.4.0`. This means that **at least** version 2.4.0 must be present. To
indicate that **any** version of a prerequisite is okay, even if the
prerequisite doesn’t define a version at all, use the version `0`.

Alternatively, a version range **may** use the operators `<` (less than), `<=`
(less than or equal), `>` (greater than), `>=` (greater than or equal), `==`
(equal), and `!=` (not equal). For example, the specification `< 2.0.0` means
that any version of the prerequisite less than 2.0.0 is suitable.

For more complicated situations, version specifications **may** be AND-ed
together using commas. The specification `>= 1.2.0, != 1.5.0, < 2.0.0`
indicates a version that must be **at least** 1.2.0, **less than** 2.0.0, and
**not equal to** 1.5.0.

Prerequisites
=============

Prereq Spec
-----------

The `prereqs` key defines the relationship between a distribution and other
extensions. The prereq spec structure is a hierarchical data structure which
divides prerequisites into *Phases* of activity in the installation process
and *Relationships* that indicate how prerequisites should be resolved.

For example, to specify that `pgtap` is required during the `test` phase, this
entry would appear in the distribution metadata:

``` json
"prereqs": {
  "test": {
    "requires": {
      "pgtap": 0
    }
  }
}
```

Note that the `prereqs` key may not be used to specify prerequisites
distributed outside PGXN or the PostgreSQL core and its contrib extensions.

### Phases ###

Requirements for regular use must be listed in the `runtime` phase. Other
requirements should be listed in the earliest stage in which they are required
and consumers must accumulate and satisfy requirements across phases before
executing the activity. For example, `build` requirements must also be
available during the `test` phase.

  before action | requirements that must be met
----------------|---------------------------------
  ./configure   | configure
  make          | configure, runtime, build
  make test     | configure, runtime, build, test

Consumers that install the distribution must ensure that *runtime*
requirements are also installed and may install dependencies from other
phases.

  after action  | requirements that must be met
----------------|---------------------------------
  make install  | runtime

*   **configure**: The configure phase occurs before any dynamic configuration
    has been attempted. Extensions required by the configure phase **must** be
    available for use before the distribution building tool has been executed.

*   **build**: The build phase is when the distribution’s source code is
    compiled (if necessary) and otherwise made ready for installation.

*   **test**: The test phase is when the distribution’s automated test suite
    is run. Any extension needed only for testing and not for subsequent use
    should be listed here.

*   **runtime**: The runtime phase refers not only to when the distribution’s
    contents are installed, but also to its continued use. Any extension that
    is a prerequisite for regular use of this distribution should be indicated
    here.

*   **develop**: The develop phase’s prereqs are extensions needed to work on
    the distribution’s source code as its maintainer does. These tools might
    be needed to build a release tarball, to run maintainer-only tests, or to
    perform other tasks related to developing new versions of the
    distribution.

### Relationships ###

requires
:   These dependencies **must** be installed for proper completion of the
    phase.

recommends
:   Recommended dependencies are *strongly* encouraged and should be satisfied
    except in resource constrained environments.

suggests
:   These dependencies are optional, but are suggested for enhanced operation
    of the described distribution.

conflicts
:   These dependencies cannot be installed when the phase is in operation.
    This is a very rare situation, and the conflicts relationship should be
    used with great caution, or not at all.

Merging and Resolving Prerequisites
-----------------------------------

Whenever metadata consumers merge prerequisites, they should be merged in a
way that preserves the intended semantics of the prerequisite structure.
Generally, this means concatenating the version specifications using commas,
as described in the [Version Ranges](#Version.Ranges) section.

A subtle error that can occur when resolving prerequisites comes from the way
that extensions in prerequisites are indexed to distribution files on PGXN.
When a extension is deleted from a distribution, prerequisites calling for
that extension could indicate that an older distribution should installed,
potentially overwriting files from a newer distribution.

For example, say the PGXN index contained these extension-distribution
mappings:

  Extension | Version |   Distribution
------------|---------|------------------
 pgtap      | 0.25.0  | pgtap-0.25.0.zip
 schematap  | 0.25.0  | pgtap-0.25.0.zip
 functap    | 0.18.1  | pgtap-0.18.1.zip

Note that functap was removed from the pgtap distribution sometime after
0.18.1. Consider the case where pgtap 0.25.0 is installed. If a distribution
specified "functap" as a prerequisite, it could result in
`pgtap-0.18.1.tar.gz` being installed, overwriting any files from
`pgtap-0.25.0.zip`.

Consumers of metadata **should** test whether prerequisites would result in
installed module files being "downgraded" to an older version and **may** warn
users or ignore the prerequisite that would cause such a result.

Serialization
=============

Distribution metadata should be serialized as JSON-encoded data and packaged
with distributions as the file `META.json`.

Notes For Implementors
======================

Comparing Version Numbers
-------------------------

Following the [Semantic Versioning 2.0.0 Spec][semver], version numbers
**must** be strictly compared by splitting the [Version](#Version) string on
full stop characters (i.e. "dots", "periods" or "decimal points") and
comparing each of the three parts as integers. If a dash and prerelease ASCII
string has been appended to the third number, it will be extracted and
compared in ASCII-betical order, and in any event will be considered to be
less than an un-encumbered third integer of the same value. Some examples:

```
0.12.1      < 0.12.2
1.42.0      > 1.41.99
2.0.0       > 1.999.999
2.0.0alpha3 < 2.0.0beta1
2.0.0beta   < 2.0.0
```

See Also
========

* [CPAN Meta Spec]
* [PGXN]
* [JSON]
* [Semantic Versioning 2.0.0][semver]

Contributors
============

The PGXN Meta Spec borrows heavily from the [CPAN Meta Spec], which was
originally written by Ken Williams in 2003 and has since been updated by Randy
Sims, David Golden, and Ricardo Signes. Ported to PGXN by David E. Wheeler.

  [source code repository]: https://www.rfc-editor.org/info/rfc9591
  [PostgreSQL License]: https://www.postgresql.org/about/licence/
  [CC BY-SA 4.0]: https://creativecommons.org/licenses/by-sa/4.0/ "Attribution-Sharealike 4.0 International"
  [Github Flavored Markdown]: https://github.github.com/gfm/
  [Markdown]: https://daringfireball.net/projects/markdown/
  [master.pgxn.org/meta/spec.txt]: https://master.pgxn.org/meta/spec.txt
  [pgxn.org/spec/]: https://pgxn.org/spec/
  [`semver`]: https://pgxn.org/dist/semver/
  [`vector`]: https://pgxn.org/dist/vector/
  [`citus`]: https://pgxn.org/dist/citus/
  [`CREATE EXTENSION` statement]: https://www.postgresql.org/docs/current/static/sql-createextension.html
  [IETF RFC 2119]: https://www.ietf.org/rfc/rfc2119.txt
  [JSON]: https://json.org/
  [IETF RFC 3986]: https://www.rfc-editor.org/info/rfc3986
    "RFC 3986: Uniform Resource Identifier (URI): Generic Syntax"
  [purl spec]: https://github.com/package-url/purl-spec
    "package-url/purl-spec: A minimal specification a “mostly universal” package URL"
  [purl Types]: https://github.com/package-url/purl-spec/blob/master/PURL-TYPES.rst
    "Package URL Type definitions"
  [semver]: https://semver.org/
  [SPDX License List]: https://github.com/spdx/license-list-data/
  [SPDX Standard License Expression]:
    https://spdx.github.io/spdx-spec/v3.0/annexes/SPDX-license-expressions/
  [control file]: https://www.postgresql.org/docs/current/extend-extensions.html
  [trusted language extension]: https://github.com/aws/pg_tle
    "pg_tle: Framework for building trusted language extensions for PostgreSQL"
  [background workers]: https://www.postgresql.org/docs/current/bgworker.html
    "PostgreSQL Docs: Background Worker Processes"
  [loadable modules]: https://www.postgresql.org/docs/16/gist-extensibility.html
  [gitignore format]: https://git-scm.com/docs/gitignore
  [bulid farm animals]: https://buildfarm.postgresql.org/cgi-bin/show_members.pl
  [configure flags]: https://www.postgresql.org/docs/current/install-make.html#CONFIGURE-OPTIONS-FEATURES
  [Repology API]: https://repology.org/api "Repology, the packaging hub: API"
  [contrib]: https://www.postgresql.org/docs/current/contrib.html
  [auto_explain]: https://www.postgresql.org/docs/current/auto-explain.html
  [dblink]: https://www.postgresql.org/docs/current/dblink.html
  [pg_regress]: https://github.com/postgres/postgres/tree/master/src/test/regress
  [pg_isolation_regress]: https://github.com/postgres/postgres/tree/master/src/test/isolation
  [Shields badge specification]: https://github.com/badges/shields/blob/master/spec/SPECIFICATION.md
  [CPAN Meta Spec]: https://metacpan.org/pod/CPAN::Meta::Spec
  [PGXN]: https://pgxn.org/
  [musl]: https://musl.libc.org/
  [GNU]: https://www.gnu.org/software/libc/
